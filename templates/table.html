{% extends "index.html" %}
{% block table %}

<style>

table {
  height: 90vh;
}

tbody {
  overflow-y: auto;
  overflow-x: auto;
}

.table th {
  border-bottom: 0.2rem solid {{ '#0f057b' if sheet.typ == 'freq' else '#00511c' }};
  background: white;
}

.table td, .table th {
  padding: 0.4rem 0.4rem;
}

.loading-table {
  color: grey;
}

[x-cloak] {
  display: none !important;
}

.filtered-val {
  color: #604d02;
}

.filtered td {
  color: #bcbcbc;
}

.null {
  color: #c42b2b;
}

td.wrapped-cell {
  min-width: 300px;
  white-space: normal;
}

td.clipped-cell {
  table-layout: fixed;
  max-width: 250px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

th.hidden-col {
  color: #bcbcbc00;
  background: #dededc;
  overflow: hidden;
  width: 15px;
  max-width: 15px;
}

td.hidden-cell {
  color: #bcbcbc00;
  overflow: hidden;
  width: 0px;
  max-width: 0px;
  min-width: 0px;
  white-space: unset;
}

.active td {
  background: {{ '#cad4e3' if sheet.typ == 'freq' else '#c2c8c0' }};
}

td.percentage {
  background-image: linear-gradient(rgb(0, 0, 0, 0) 0%, rgb(0, 0, 0, 0) 75%, rgb(153, 172, 247) 76%, rgb(153, 172, 247) 100%);  /* your gradient */
  background-repeat: no-repeat;
}

.selected-col {
  background: {{ '#eef0f3' if sheet.typ == 'freq' else '#dfe7ea' }};
}

th.key-col {
  background: #9b86ff;
}

th.agg-col {
  background: #ff2b85;
}

td.selected-cell {
  background: {{ '#d4ddf7' if sheet.typ == 'freq' else '#b7c8b5' }};
}

.hidden {
  visibility: hidden;
}

.progress {
  width: 100%;
}

.progress:indeterminate {
  background-image: linear-gradient(to right, grey 30%, rgb(238, 240, 243) 30%);
}

.sorted-col {
  background-color: #ededec;
}

li.breadcrumb-item a {
  color: grey;
}

.close-btn {
  background-color: white;
  border: none;
  color: black;
  padding: 0px 0px 0px 7px;
  font-size: 19px;
  cursor: pointer;
}

#table-footer {
  margin: 0.5rem 0;
  background-color: whitesmoke;
}

#parent-sheets {
  padding: 0.2rem 0.5rem;
}

.navbar-links {
  margin-left: 0.5rem;
}
.navbar-links a {
  color: grey;
}

#cheatsheet {
  margin: 3rem 1rem;
  color: grey;
  font-size: 0.6rem;
  font-family: 'Courier New', monospace;
}


</style>
<div id="table-parent" x-data="sheet_parent()" x-bind="sheet_parent_bind()">
  <div class="container">

    <div class="columns">
      <div class="column col-1 hide-xl loading hidden" x-bind="progress()"></div>
      <ul id="parent-sheets" class="column col-9 breadcrumb">
        {% if sheet.lineage|length > 1 %}
        {% for parent in sheet.lineage %}
        <li class="breadcrumb-item">
          <a href="/sheets/{{ parent.uid }}">{{ parent }}</a>
        </li>
        {% endfor %}
        {% endif %}
      </ul>
      <div style="padding: 0.6rem" class="column col-2 col-ml-auto">
        <span class="navbar-links"><a href="/downloads/{{ sheet.uid }}/">Download</a><span>
        <span class="navbar-links"><a href="/about">About</a></span>
      </div>
      <div class="column col-1">
      </div>
    </div>

    <div class="columns">
      <div class="column col-1 hide-xl">
        <div id="cheatsheet">
          <p><span class="label">?</span> hide cheatsheet</p>
          <p> Arrow /
            <span class="label">j</span>
            <span class="label">k</span>
            <span class="label">h</span>
            <span class="label">l</span>
          navigate
          </p>
          <p><span class="label">F</span> frequency</p>
          <p>
            <span class="label">q</span> back
            <br/>
            <span class="label">p</span> forward
          </p>
          <p>
            <span class="label">]</span> sort desc
            <br/>
            <span class="label">[</span> sort asc
          </p>
        </div>
      </div>
      <div class="column col-10 col-xl-auto">
        <table class="table table-scroll"
          style="border-collapse: separate;"
          x-cloak
          x-data="sheet({{ rows|length }}, {{ columns|length }}, {{ sheet.parent.uid }}, {{ sheet.wrapped_col_indices }})"
          x-bind="
          {% if sheet.typ == 'freq' %}
          {{ sheet.typ }}_sheet({{ sheet.key_col_indices }})
          {% else %}
          {{ sheet.typ }}_sheet()
          {% endif %}
          ">
            <tr x-ref="header">
              {% for col in columns %}
              <th
                x-ref="col-{{ loop.index0 }}"
                x-bind="col({{ loop.index0 }})"
                class="{{ 'sorted-col' if col in sheet.orderbys else '' }}"
                data-colname="{{ col }}"
                >
              {{ col }}
                {% if col in sheet.orderbys %}
                <span class="arrow">
                  {{ '↑' if sheet.orderbys[col] else '↓' }}
                </span>
                {% endif %}
              </th>
              {% endfor %}
            </tr>
            <tr style="display: none" x-bind="search_row()">
              {% for col in columns %}
              <td>
                <div
                  x-bind="search_div({{ loop.index0 }})"
                  x-ref="search-{{ loop.index0 }}"
                  style="display: none"
                  >
                <input style="display: inline" x-bind="search_input({{ loop.index0 }})" class="form-input" type="text" placeholder="Regex search">
                <button
                  x-bind="search_close_btn()"
                  class="close-btn tooltip"
                  data-tooltip="[Esc]">
                  <span>&times;</span>
                </button>
                <div>
              </td>
              {% endfor %}
            </tr>
          {% for row in rows %}
          {% set outerloop = loop %}
          <tr
            x-bind="row({{ loop.index0 }})"
            x-ref="row-{{ outerloop.index0 }}" >

            {% for col in columns %}
            <td x-ref="cell-{{ outerloop.index0 }}-{{ loop.index0 }}"
                x-bind="cell({{ outerloop.index0 }}, {{ loop.index0 }})"
                class="
                {% if row[loop.index0] is none %}
                null
                {% elif col == 'percentage' %}
                percentage
                {% endif %}
                "
                style="
                {% if col == 'percentage' %}
                background-size: {{ row[loop.index0] }}% 100%;
                {% endif %}
                "
                >
              {% if row[loop.index0] is none %}
                NaN
              {% else %}
              {{ row[loop.index0] }}
              {% endif %}
            </td>
            {% endfor %}
          </tr>
            {% endfor %}
        </table>
        <div id="table-footer" x-cloak>
          <b>{{ num_rows }}</b> rows
          <span style="float: right">
            {% if has_prev_page %}
              <a id="previous-page" href="/sheets/{{ sheet.uid }}?page={{ page - 1 }}">prev</a>
            {% else %}
              prev
            {% endif %}
            <span class="label">[P]</span>
            |
            {% if has_next_page %}
              <a id="next-page" href="/sheets/{{ sheet.uid }}?page={{ page + 1 }}">next</a>
            {% else %}
              next
            {% endif %}
            <span class="label">[N]</span>
          </span>
        <div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
